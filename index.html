<!DOCTYPE html>
<html lang="zh" class="js">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>流量消耗器</title>
<meta name="keywords" content="IP查询,IP归属查询,在线测速,网速测试,多地IP查询,流量消耗器">
<meta name="description" content="测试您的网速，同时具备网络延迟实时检测">
<meta http-equiv="Cache-Control" content="no-store">

<link rel="stylesheet" href="res/dashlite.css">
<link rel="stylesheet" href="res/style.css">
<link rel="shortcut icon" href="images/favicon.ico">
<link rel="stylesheet" href="res/layer.css">

<script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

<style>
.stat{width:100%;column-gap:1rem;padding:1rem 1.5rem;}
.stat-title{white-space:nowrap;opacity:.6;}
.stat-value{white-space:nowrap;grid-column-start:1;font-size:1.8rem;font-weight:700;line-height:2.5rem;}
.nk-menu-item a{text-decoration:none;}
.header-center-tools{display:flex;align-items:center;justify-content:center;gap:14px;flex-wrap:wrap;}
.header-center-tools a{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;}
.header-center-tools .icon{font-size:18px;}
.header-grid{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:10px;width:100%;}
.header-left{justify-self:start;display:flex;align-items:center;gap:10px;}
.header-center{justify-self:center;}
.header-right{justify-self:end;}
.ip-row{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-bottom:1px solid rgba(0,0,0,.06);}
.ip-row:last-child{border-bottom:0;}
.ip-label{opacity:.75;}
.ip-value{text-align:right;word-break:break-all;}
.ip-loc{opacity:.7;margin-left:6px;}
.muted{opacity:.7;font-size:12px;}
.page-footer{text-align:center;padding:18px 12px 30px;opacity:.75;font-size:13px;}
.page-footer a{text-decoration:none;}
</style>
</head>

<body class="nk-body npc-invest bg-lighter no-touch nk-nio-theme" style="cursor:pointer">
<div class="nk-wrap">

<div class="nk-header nk-header-fluid nk-header-fixed is-light">
<div class="container-xl">
<div class="nk-header-wrap link-between" style="width:100%;">
<div class="header-grid">

<div class="header-left">
<div class="nk-menu-trigger mr-sm-2 d-lg-none">
<a href="#" class="nk-nav-toggle nk-quick-nav-icon" data-target="headerNav">
<em class="icon ni ni-menu"></em>
</a>
</div>
<div class="nk-header-brand">
<a href="#" class="logo-link text-base">
<img src="images/流量.png" class="hide-mb-sm">
流量消耗器
</a>
</div>
</div>

<div class="header-center">
<div class="header-center-tools">
<a href="https://ip.ipgg.cn" class="nk-menu-link nk-ibx-action-item" target="_blank">
<em class="icon ni ni-map"></em>
<span class="nk-menu-text">IP归属查询</span>
</a>
<a href="https://v6test.ipgg.cn" class="nk-menu-link nk-ibx-action-item" target="_blank">
<em class="icon ni ni-network"></em>
<span class="nk-menu-text">IPV6检测</span>
</a>
<a href="javascript:;" class="progress-rating dark-switch">
<span class="nk-menu-icon">
<em class="icon ni ni-moon"></em>
<em class="icon ni ni-sun d-none"></em>
</span>
</a>
</div>
</div>

<div class="header-right"></div>

</div>
</div>
</div>
</div>

<div class="nk-content nk-content-lg nk-content-fluid" style="padding-top:90px;">
<div id="app" class="container-xl">
<div class="col-sm-12 col-md-10 col-xl-8 center-block">

<div class="card card-preview">
<div class="card-inner">
<div class="nya-title nk-ibx-action-item progress-rating">
<em class="icon ni ni-info"></em>
<span class="nk-menu-text font-weight-bold">工具说明</span>
</div>
<div class="accordion-inner">
<div class="title"><span class="dot dot-lg sq"></span>&nbsp;<span>虽支持可自定义地址，但无法请求跨域链接</span></div>
<div class="title"><span class="dot dot-lg sq"></span>&nbsp;<span>速度不满意？请尝试手动切换测速源，加大运行线程</span></div>
</div>
</div>
</div>

<div class="card card-preview">
<div class="card-inner mt-3">
<div class="nya-title nk-ibx-action-item progress-rating">
<em class="icon ni ni-setting"></em>
<span class="nk-menu-text font-weight-bold">测试设置</span>
</div>

<div class="form-group">
<label class="form-label">测试地址</label>
<div class="form-control-wrap">
<select id="select" onchange="document.getElementById('link').value=this.options[this.selectedIndex].value;setCookie('select',this.selectedIndex,365);" class="form-control">
<option value="" id="diy">自定义</option>

<optgroup label="国内测速点">
<option selected value="https://lf5-j1gamecdn-cn.dailygn.com/obj/lf-game-lf/gdl_app_2682/1233880772355.mp4">
朝夕光年游戏(点击此处可更换测速源)
</option>
</optgroup>

<optgroup label="国外测速点">
<option value="https://emp.bbci.co.uk/emp/dashjs/3.2.0-8/dash.all.min.js">BBC中文网</option>
</optgroup>

</select>

<input value=""
oninput="document.getElementById('select').selectedIndex=0;document.getElementById('diy').value=this.value;setCookie('diy',this.value,365);setCookie('select',0,365);"
type="text" id="link" placeholder="请输入下载链接" autocomplete="off" class="form-control">
</div>
</div>

<div class="form-group">
<label class="form-label">线程</label>
<div class="form-control-wrap number-spinner-wrap">
<button onclick="var thread=document.getElementById('thread');if(thread.value!=thread.min)thread.value--;" class="btn btn-icon btn-outline-primary number-spinner-btn number-minus"><em class="icon ni ni-minus"></em></button>
<input onchange="var self=document.getElementById('thread');if(self.value<self.min)self.value=self.min;if(self.value>self.max)self.value=self.max" id="thread" type="number" min="1" max="32" value="1" class="form-control number-spinner">
<button onclick="var thread=document.getElementById('thread');if(thread.value!=thread.max)thread.value++;" class="btn btn-icon btn-outline-primary number-spinner-btn number-plus"><em class="icon ni ni-plus"></em></button>
</div>
</div>

<button onclick="botton_clicked();" type="button" id="do" class="btn btn-dim btn-outline-secondary btn-block card-link">开始</button>

</div>
</div>

<div class="card card-preview">
<div class="card-inner">
<div class="nya-title nk-ibx-action-item progress-rating">
<em class="icon ni ni-location"></em>
<span class="nk-menu-text font-weight-bold">出口地址</span>
</div>

<div style="margin-top:10px;">
<div class="ip-row">
<div class="ip-label">IPv4</div>
<div class="ip-value">
<span id="ipv4">Loading...</span>
<span id="ipv4_loc" class="ip-loc"></span>
</div>
</div>
</div>

</div>
</div>

<div class="page-footer">
本页面基于开源项目：
<a href="https://github.com/xinycai/traffic_deplete" target="_blank">xinycai/traffic_deplete</a>
</div>

</div>
</div>
</div>
</div>

<audio controls id="music" loop style="display:none">
<source src="res/background.mp3" type="audio/mpeg">
</audio>

<script src="main.js?5"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/layer.js"></script>
<script src="js/nioapp.min.js"></script>
<script src="js/script.js"></script>
<script src="js/common.js"></script>

<script>
function extractIpv4(text){const m=(text||'').match(/(\d{1,3}\.){3}\d{1,3}/);return m?m[0]:'';}

async function fetchIpv4(){
try{const r=await fetch('https://api.ipify.org?format=json');const j=await r.json();if(j.ip)return j.ip;}catch(e){}
try{const r=await fetch('https://v4.ipgg.cn');const t=await r.text();const ip=extractIpv4(t.trim());if(ip)return ip;}catch(e){}
return '';
}

async function geoZh(ip){
if(!ip)return '';
try{
const url='https://webapi-pc.meitu.com/common/ip_location?ip='+encodeURIComponent(ip);
const r=await fetch(url);
const j=await r.json();
const d=j?.data?.[ip];
if(j?.code===0&&d){
const parts=[d.nation,d.province,d.city,d.isp].filter(Boolean);
return parts.length?`（${parts.join(' ')}）`:'';
}
}catch(e){}
return '';
}

async function loadIpv4AndLoc(){
const ipv4El=document.getElementById('ipv4');
const locEl=document.getElementById('ipv4_loc');
ipv4El.textContent='Loading...';
locEl.textContent='';
const ip=await fetchIpv4();
if(!ip){ipv4El.textContent='NULL';return;}
ipv4El.textContent=ip;
const loc=await geoZh(ip);
locEl.textContent=loc||'';
}

document.addEventListener('DOMContentLoaded',loadIpv4AndLoc);
</script>

</body>
</html>
